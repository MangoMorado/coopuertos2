# Configuración completa de Nixpacks para Coopuertos

[phases.setup]
nixPkgs = [
    "php82",
    "php82Extensions.imagick",
    "nginx",
    "libmysqlclient",
    "phpPackages.composer",
    "nodejs_22",
    "imagemagick",
    "python312Packages.supervisor",
]

[phases.install]
cmds = [
    "mkdir -p /var/log/nginx",
    "mkdir -p /var/cache/nginx",
    "composer install --ignore-platform-reqs",
    "npm ci",
]

[phases.build]
cmds = [
    "npm run build",
    "chmod -R 775 storage bootstrap/cache public/uploads",
    "php artisan storage:link || true",
    "chmod +x scripts/enable-imagick.sh || true",
    "bash scripts/enable-imagick.sh || echo '⚠️ No se pudo habilitar imagick automáticamente'",
    "chmod +x scripts/setup-supervisor-start.sh || true",
    "chmod +x scripts/start.sh || true",
]

[start]
cmd = "bash /app/scripts/start.sh"
