[phases]

# 1. Fase de Configuración (Setup)
# Asegura que Node.js esté disponible para el build de Vite
setup = { # Nixpacks detecta la necesidad de Node por el package.json, pero a veces es bueno ser explícito
    apt = ["git", "unzip"],
    # Crea los directorios ignorados por Git
    cmds = ["mkdir -p public/uploads/{carnets,conductores,pqrs,vehiculos}"]
}

# 2. Fase de Construcción (Build)
# Aquí se instalan dependencias y se ejecuta la compilación de assets
[phases.build]
cmds = [
    # Instala las dependencias de Node.js
    "npm install", 
    # **IMPORTANTE**: Ejecuta el comando de build de Vite para generar public/build/manifest.json
    "npm run build", 
    # Asigna permisos a los directorios que necesitan escritura
    "chmod -R 775 storage bootstrap/cache",
    "chmod -R 775 public/uploads",
    # Crea el symlink del storage
    "php artisan storage:link"
]